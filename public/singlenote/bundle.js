!function(i){function t(s){if(o[s])return o[s].exports;var e=o[s]={exports:{},id:s,loaded:!1};return i[s].call(e.exports,e,e.exports,t),e.loaded=!0,e.exports}var o={};return t.m=i,t.c=o,t.p="/",t(0)}({0:function(i,t,o){"use strict";function s(i){return i&&i.__esModule?i:{default:i}}var e=o(175),n=(s(e),o(176)),a={addtime:"",ctx:"",flag:!1,clickUpX:"",clickUpY:"",clickDownX:"",clickDownY:"",pencilX:0,pencilY:0,boxID:"",note_info:{time:"",author:"",note_id:"",x_pos:"",y_pos:"",comment:""},init:function(i,t){var o=this;this.boxID=t,this.listen_creat(i,t),this.listen_pencil(),n("#close").click(function(){o.close_and_clean()}),n("#window_add").click(function(){var i;i=!0;var t=n(".window_content").val();if(console.log(t),t){o.note_info.time==o.addtime&&(o.note_info.comment=t);var s=o.addtime,e=(o.pencilX,o.pencilY,document.getElementById("content_jq"),n("<div class='addnewBulb' id='"+s+"' data-comment='"+t+"' data-bulbid='"+o.addtime+"'></div>"));n("#content_jq").append(e),e.css({"z-index":1e3,left:o.clickDownX+3,top:o.clickDownY-10,click:o.showclickdialog(),hover:o.showhoverdialog()}),n("canvas[id="+s+"]").css({display:"none"});var a=n(".list"),c=n("<div forid='"+s+"'>"+t+"</div>");a.append(c),c.hover(function(){n(this).removeClass().addClass("postilBarFocus");var i=n(this).attr("forid");n("canvas[id="+i+"]").css({display:"block"})},function(){n(this).removeClass().addClass("postilBar");var i=n(this).attr("forid");n("canvas[id="+i+"]").css({display:"none"})}),n.ajax({url:"/addcomment",type:"POST",data:o.note_info,success:function(i){console.log(i),o.close_and_clean()},error:function(){alert("ajax error")}})}else alert("点开我什么都不说就想走？惊了！")}),n.ajax({url:"/getcomment",type:"POST",data:{note_id:n("#note_id").html()},success:function(i){console.log(i);for(var t=0;t<i.length;t++){var s=n("<canvas id='"+i[t].time+"' class='canvasSize' style='display: none;'></canvas>");n("#"+o.boxID).append(s);var e=n("#"+o.boxID)[0];s[0].width=e.offsetWidth,s[0].height=e.offsetHeight;var a=s[0].getContext("2d");a.lineWidth=1,a.strokeStyle="#FC2222",a.beginPath(),a.shadowBlur=1;var c=i[t].x_pos.split(","),l=i[t].y_pos.split(",");a.moveTo(c[0],l[0]);for(var d=1;d<c.length-1;d++)a.lineTo(c[d],l[d]),a.stroke();var r=n("<div class='addnewBulb' id='"+i[t].time+"' data-comment='"+i[t].comment+"' data-bulbid='"+i[t].time+"'></div>");n("#content_jq").append(r),r.css({"z-index":1e3,left:i[t].x_pos.split(",")[0]+"px",top:i[t].y_pos.split(",")[0]+"px",click:o.showclickdialog(),hover:o.showhoverdialog()});var h=n("#listbar"),v=n("<div forid='"+i[t].time+"'>"+i[t].comment+"</div>");h.append(v),v.hover(function(){n(this).removeClass().addClass("postilBarFocus");var i=n(this).attr("forid");n("canvas[id="+i+"]").css({display:"block"})},function(){n(this).removeClass().addClass("postilBar");var i=n(this).attr("forid");n("canvas[id="+i+"]").css({display:"none"})})}},error:function(){console.log("拉取评论出错")}}),n(".opera_showidea").click(function(i){var t=n(i.target).attr("flag");"show"===t?(n("div[class=addnewBulb]").css({visibility:"hidden"}),n(i.target).html("x").attr("flag","hide")):"hide"===t&&(n("div[class=addnewBulb]").css({visibility:"visible"}),n(i.target).html("o").attr("flag","show"))})},listen_creat:function(i,t){var o=this;n("#"+i).click(function(){o.addCanvas(t)})},addCanvas:function(i){var t=(new Date).getTime();this.addtime=t,this.note_info.time=t,this.note_info.x_pos="",this.note_info.y_pos="",this.note_info.note_id=n("#note_id").html();var o=this,s=n("<canvas id='"+t+"' class='canvasSize'></canvas>");n("#"+i).append(s);var e=n("#"+i)[0],a=n("#"+t);a.bind("mousedown",function(i){o.onMouseDown(i)}),a.bind("mousemove",function(i){o.onMouseMove(i)}),a.bind("mouseup",function(i){o.onMouseUp(i)}),a[0].width=e.offsetWidth,a[0].height=e.offsetHeight,this.ctx=a[0].getContext("2d"),this.ctx.lineWidth=3,this.ctx.strokeStyle="#FC2222"},onMouseDown:function(i){i.preventDefault(),this.ctx.beginPath();var t=this.pos(i);this.clickDownX=t.x,this.clickDownY=t.y,this.ctx.moveTo(t.x,t.y),this.flag=!0},onMouseMove:function(i){if(i.preventDefault(),this.flag){var t=this.pos(i);this.note_info.x_pos+=t.x+",",this.note_info.y_pos+=t.y+",",this.ctx.lineTo(t.x,t.y),this.ctx.lineWidth=.5,this.ctx.shadowBlur=1,this.ctx.stroke()}},onMouseUp:function(i){console.log(this.note_info),i.preventDefault(),this.flag=!1;var t=this.pos(i);this.clickUpX=t.x,this.clickUpY=t.y,this.clickDownX==this.clickUpX&&this.clickDownY==this.clickUpY||this.showPencil(i)},pos:function(i){var t,o;return t=i.offsetX,o=i.offsetY,{x:t,y:o}},showPencil:function(i){console.log(i);var t=i.offsetX,o=i.offsetY;this.pencilX=t,this.pencilY=o,n("#pencilIcon").css({width:25,height:25,left:t-20,top:o-20,display:"block"}).fadeIn(300)},listen_pencil:function(){n("#pencilIcon").click(function(){n("#comment_window").css({display:"block"})})},close_and_clean:function(){n("canvas[id="+this.addtime+"]").css({display:"none"}),n("#pencilIcon").css({display:"none"}),n("#comment_window").css({display:"none"})},showclickdialog:function(){n("div[class=addnewBulb]").click(function(i){n("div[id=listbar]").css({visibility:"visible"})})},showhoverdialog:function(){n("div[class=addnewBulb]").hover(function(i){var t=n(this).attr("id");n("div[forid="+t+"]").removeClass().addClass("postilBarFocus"),n("canvas[id="+t+"]").css({display:"block"});var o=n(this).position().left,s=n(this).position().top,e=n(this).attr("data-comment"),a=n("#hoverdialog"),c=n("div[selecthover="+t+"]")[0];if(!c){var l=n("<div selecthover="+t+" class=hoverdialogcss>"+e+"</div>");a.append(l)}var d=n("div[selecthover="+t+"]")[0].offsetHeight,r=n("div[selecthover="+t+"]")[0].offsetWidth;n("div[selecthover="+t+"]").css({left:o-r/2,top:s-d-10,visibility:"visible"})},function(i){var t=n(this).attr("id");n("div[forid="+t+"]").removeClass().addClass("postilBar"),n("canvas[id="+t+"]").css({display:"none"}),n("div[selecthover="+t+"]").css({visibility:"hidden"})})}};a.init("add_comment","content_jq")},175:function(i,t){},176:function(i,t){i.exports=window.$}});